{% extends "base.html" %}

{% block content %}

<h2>Lista de Pedidos</h2>

<p>Aquí se listarán los pedidos...</p>
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Lista de Pedidos</h2>
    {% if session["rol"] == "jefe" %}
        <a href="{{ url_for('pedidos.crear_pedido') }}" class="btn btn-primary">
            Nuevo Pedido
        </a>
    {% endif %}
</div>
<table class="table table-striped table-hover">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th>Responsable</th>
            <th>Fecha Entrega</th>
            <th>Valor Total</th>
            <th>Anticipo</th>
            <th>Saldo</th>
            <th>Acciones</th>

        </tr>
    </thead>
    <tbody>
        {% for pedido in pedidos %}
        <tr>
            <td>{{ pedido.id }}</td>
            <td>{{ pedido.cliente_nombre }}</td>
            <td>{{ pedido.descripcion }}</td>
            <td>
                {% if pedido.estado == "terminado" %}
                    <strong style="color: green;">Terminado</strong>
                {% else %}
                    <form method="POST" action="{{ url_for('pedidos.actualizar_estado', pedido_id=pedido.id) }}">
                        <select name="estado">
                            <option value="pendiente" {% if pedido.estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
                            <option value="en_proceso" {% if pedido.estado == 'en_proceso' %}selected{% endif %}>En proceso</option>
                            <option value="terminado" {% if pedido.estado == 'terminado' %}selected{% endif %}>Terminado</option>
                        </select>
                        <button type="submit">Actualizar</button>
                    </form>
                {% endif %}
            </td>
            <td>
                {% if pedido.responsable_nombre %}
                    {{ pedido.responsable_nombre }}
                {% else %}
                    Sin asignar
                {% endif %}
            </td>
            <td>{{ pedido.fecha_entrega }}</td>
            <td>{{ pedido.valor_total }}</td>
            <td>{{ pedido.anticipo }}</td>
            <td>{{ pedido.saldo }}</td>
            <td>
                <a href="{{ url_for('pedidos.detalle_pedido', pedido_id=pedido.id) }}">
                    Ver
                </a>
            </td>

        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="{{ url_for('dashboard.home') }}">Volver al Dashboard</a>

{% endblock %}