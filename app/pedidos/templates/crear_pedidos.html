{% extends "base.html" %}

{% block content %}

<div class="container mt-4">
    <div class="card shadow p-4">
        <h2 class="mb-4">Crear Pedido</h2>

        <form method="POST">

            <!-- Tipo cliente -->
            <div class="mb-3">
                <label class="form-label">Tipo de cliente:</label>
                <select name="tipo_cliente" id="tipo_cliente" class="form-select" onchange="toggleCliente()">
                    <option value="existente">Cliente existente</option>
                    <option value="nuevo">Cliente nuevo</option>
                </select>
            </div>

            <!-- Cliente existente -->
            <div id="cliente_existente_div" class="mb-3">
                <label class="form-label">Seleccionar cliente:</label>
                <select name="cliente_existente" class="form-select">
                    {% for cliente in clientes %}
                        <option value="{{ cliente.id }}">
                            {{ cliente.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Cliente nuevo -->
            <div id="cliente_nuevo_div" style="display:none;">
                <div class="mb-3">
                    <label class="form-label">Nombre:</label>
                    <input type="text" name="nombre" class="form-control">
                </div>

                <div class="mb-3">
                    <label class="form-label">Teléfono:</label>
                    <input type="text" name="telefono" class="form-control">
                </div>

                <div class="mb-3">
                    <label class="form-label">Correo:</label>
                    <input type="email" name="correo" class="form-control">
                </div>
            </div>

            <!-- Descripción -->
            <div class="mb-3">
                <label class="form-label">Descripción:</label>
                <textarea name="descripcion" class="form-control" required></textarea>
            </div>

            <!-- Fecha entrega -->
            <div class="mb-3">
                <label class="form-label">Fecha entrega:</label>
                <input type="date" name="fecha_entrega" class="form-control">
            </div>

            <!-- Valor total -->
            <div class="mb-3">
                <label class="form-label">Valor total:</label>
                <input type="number" step="0.01" name="valor_total" class="form-control">
            </div>

            <!-- Anticipo -->
            <div class="mb-3">
                <label class="form-label">Anticipo:</label>
                <input type="number" step="0.01" name="anticipo" class="form-control">
            </div>

            <!-- Responsable -->
            <div class="mb-4">
                <label class="form-label">Asignar a empleado:</label>
                <select name="responsable_id" class="form-select" required>
                    {% for empleado in empleados %}
                        <option value="{{ empleado.id }}">
                            {{ empleado.username }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="d-flex justify-content-between">
                <a href="{{ url_for('pedidos.listar_pedidos') }}" class="btn btn-secondary">
                    Volver
                </a>
                <button type="submit" class="btn btn-primary">
                    Crear Pedido
                </button>
            </div>

        </form>
    </div>
</div>

<script>
function toggleCliente() {
    var tipo = document.getElementById("tipo_cliente").value;
    var existente = document.getElementById("cliente_existente_div");
    var nuevo = document.getElementById("cliente_nuevo_div");

    if (tipo === "nuevo") {
        existente.style.display = "none";
        nuevo.style.display = "block";
    } else {
        existente.style.display = "block";
        nuevo.style.display = "none";
    }
}
</script>

{% endblock %}
